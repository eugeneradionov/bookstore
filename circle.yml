## Customize the test machine
machine:
  ruby:
    version:
      2.4.1

dependencies:
  pre:
    - gem install bundler
    - gem install rubygems-bundler
    - gem regenerate_binstubs
    - psql -c 'create database bookstore_test;' -U postgres
    - psql -c "CREATE USER bookstore WITH PASSWORD 'qwerty';" -U postgres
    - psql -c "GRANT ALL PRIVILEGES ON DATABASE bookstore_test TO bookstore;" -U postgres

## Customize database setup
database:
  override:
    # replace CircleCI's generated database.yml
    - cp config/database.ci.yml config/database.yml
    - bundle exec rake db:create db:schema:load

## Customize test commands
test:
  override:
    - bundle exec rspec